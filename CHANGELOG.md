# 更新日志

## 2024-12-06 - 项目重构 v2

### 插件自动发现
- ✅ 移除硬编码的插件注册
- ✅ 实现插件自动扫描和加载
- ✅ 支持零配置部署
- ✅ 插件目录即插即用

### 配置处理增强
- ✅ 添加配置辅助方法到基类
- ✅ 安全处理空字符串和None值
- ✅ 自动类型转换和错误处理
- ✅ 修复配置值转换错误（ValueError）
- ✅ 创建配置最佳实践文档

### 启动脚本增强
- ✅ 启动脚本自动检查并安装依赖
- ✅ 创建 Linux/Mac 启动脚本 (start_all.sh)
- ✅ 创建 Windows 启动脚本 (start_all.bat)
- ✅ 创建依赖安装脚本 (install_dependencies.sh/bat)
- ✅ 自动安装插件依赖
- ✅ 一键启动前后端服务

### Bug修复
- ✅ 修复插件自动发现的路径问题
- ✅ 修复配置导入导出的路径问题
- ✅ 修复插件安装删除的路径问题
- ✅ 优化插件扫描日志输出
- ✅ 添加插件发现测试脚本
- ✅ 优化下载管理界面按钮布局

## 2024-12-06 - 项目重构 v1

### 清理工作
- ✅ 删除所有测试文件 (test_*.py)
- ✅ 删除临时配置文件和HTML调试文件
- ✅ 删除所有旧的文档文件
- ✅ 创建新的README.md和项目结构文档

### 插件系统重构
- ✅ 移除YouTube插件，改为插件模板
- ✅ 创建 `plugin_template.py` 作为标准插件模板
- ✅ 所有插件默认禁用状态
- ✅ 为每个插件创建独立的requirements文件：
  - `jable_requirements.txt`
  - `seacms_requirements.txt`
  - `metube_requirements.txt`
  - `qbittorrent_requirements.txt`
  - `plugin_template_requirements.txt`

### 依赖管理优化
- ✅ 精简核心 `requirements.txt`，只保留项目必需依赖
- ✅ 插件特定依赖独立管理
- ✅ 添加版本号约束

### 插件动态管理（支持热加载）
- ✅ 新增 `POST /api/plugins/install` - 在线安装插件（支持热加载）
- ✅ 新增 `POST /api/plugins/delete` - 删除插件（支持热卸载）
- ✅ 新增 `POST /api/plugins/reload` - 重新加载所有插件
- ✅ 自动下载插件代码和依赖文件
- ✅ 自动安装插件依赖
- ✅ 插件热加载/热卸载，无需重启服务

### 配置导入导出
- ✅ 新增 `GET /api/config/export` - 导出配置
- ✅ 新增 `POST /api/config/import` - 导入配置
- ✅ 前端添加导出/导入按钮
- ✅ 支持JSON格式配置文件

### 前端改进
- ✅ Settings页面添加"安装插件"按钮
- ✅ Settings页面添加"导出配置"按钮
- ✅ Settings页面添加"导入配置"按钮
- ✅ 每个插件添加删除按钮
- ✅ 添加安装插件对话框
- ✅ 添加导入配置对话框
- ✅ 优化UI样式

### 文档
- ✅ 创建 `README.md` - 项目说明
- ✅ 创建 `PROJECT_STRUCTURE.md` - 项目结构
- ✅ 创建 `backend/plugins/README.md` - 插件开发指南
- ✅ 创建 `CHANGELOG.md` - 更新日志

## 使用说明

### 安装插件（支持热加载）
1. 在设置页面点击"📦 安装插件"
2. 选择插件类型（搜索/下载/解析器）
3. 输入插件URL
4. 点击"安装"
5. 系统会自动热加载插件，**无需重启**即可使用

### 删除插件（支持热卸载）
1. 在设置页面找到要删除的插件
2. 点击插件右侧的"🗑️"按钮
3. 确认删除
4. 系统会自动热卸载插件，**无需重启**

### 重新加载插件
1. 在设置页面点击"🔄 重新加载插件"
2. 系统会重新加载所有插件
3. 用于修复插件加载问题或更新插件代码后刷新

### 导出配置
1. 在设置页面点击"📤 导出配置"
2. 配置将自动下载为JSON文件

### 导入配置
1. 在设置页面点击"📥 导入配置"
2. 粘贴配置JSON
3. 点击"导入"
4. 页面将自动刷新

## 热加载特性

✨ **新功能：插件热加载/热卸载**

- ✅ 安装插件后自动热加载，立即可用
- ✅ 删除插件后自动热卸载，立即生效
- ✅ 支持手动重新加载所有插件
- ✅ 无需重启后端服务
- ✅ 不影响正在运行的任务

## 插件自动发现机制

系统启动时会自动扫描以下目录：
- `backend/plugins/search/` - 搜索插件
- `backend/plugins/download/` - 下载插件
- `backend/plugins/parser/` - 解析器插件

所有符合命名规范的插件文件（`*_plugin.py`）都会被自动加载，无需在代码中手动注册。

**优势**：
- ✅ 零配置部署
- ✅ 插件即插即用
- ✅ 不会因为缺少插件而报错
- ✅ 支持动态扩展

## 注意事项

- 所有插件默认禁用，需要在设置中手动启用
- 热加载功能会自动处理插件的加载和卸载
- 如果热加载失败，系统会提示需要重启服务
- 导入配置后页面会自动刷新
- 插件依赖会自动安装，但可能需要手动处理安装失败的情况
- 插件文件必须遵循命名规范：`{plugin_name}_plugin.py`
