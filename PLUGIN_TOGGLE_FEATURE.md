# 插件启用/禁用功能 & 设置界面优化

## 新增功能

### 1. 插件启用/禁用开关

每个插件现在都可以独立启用或禁用，禁用的插件不会被查询或使用。

#### 后端实现

**配置存储（config_storage.py）：**
- 添加 `is_enabled()` - 检查插件是否启用
- 添加 `set_enabled()` - 设置插件启用状态
- 配置中使用 `_enabled` 字段存储状态（默认为 true）

**插件管理器（plugin_manager.py）：**
- `list_plugins()` 返回的插件信息中包含 `enabled` 字段
- 添加 `get_enabled_plugins()` - 获取已启用的插件列表

**API（main.py）：**
```
POST /api/plugins/{plugin_type}/{plugin_name}/toggle?enabled={true|false}
```

#### 前端实现

**设置页面：**
- 每个插件卡片右上角显示开关按钮
- 点击开关可以启用/禁用插件
- 禁用的插件配置按钮会被禁用
- 禁用插件时自动收起配置区域

**下载管理：**
- 查询下载记录时自动跳过禁用的插件
- 平台选择器只显示启用的插件

### 2. 设置界面 Tab 优化

将原来一列排列的插件列表改为 Tab 切换形式，提升用户体验。

#### 界面结构

```
┌─────────────────────────────────────┐
│  插件设置                            │
├─────────────────────────────────────┤
│  [搜索插件] [下载插件]               │  ← Tab 导航
├─────────────────────────────────────┤
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 插件名称              [开关] │   │
│  │ 描述信息         [展开配置] │   │
│  │ v1.0.0                      │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌─────────────────────────────┐   │
│  │ 插件名称              [开关] │   │
│  │ 描述信息         [展开配置] │   │
│  │ v1.0.0                      │   │
│  └─────────────────────────────┘   │
│                                     │
└─────────────────────────────────────┘
```

#### Tab 功能

- **搜索插件 Tab** - 显示所有搜索插件
- **下载插件 Tab** - 显示所有下载插件
- 切换 Tab 时有平滑的动画效果
- 当前激活的 Tab 有明显的视觉标识

#### 插件卡片

每个插件显示为独立的卡片，包含：
- 插件名称
- 描述信息
- 版本号
- 支持的协议（仅下载插件）
- 启用/禁用开关
- 展开/收起配置按钮

## 使用说明

### 启用/禁用插件

1. 进入"设置"页面
2. 选择对应的 Tab（搜索插件或下载插件）
3. 找到要操作的插件
4. 点击右上角的开关按钮
5. 系统会自动保存状态

### 配置插件

1. 确保插件已启用（开关为绿色）
2. 点击"展开配置"按钮
3. 填写配置信息
4. 点击"保存"按钮
5. 配置区域会自动收起

### 查看插件状态

- **绿色开关** - 插件已启用
- **灰色开关** - 插件已禁用
- **禁用的配置按钮** - 插件未启用，无法配置

## API 使用

### 获取插件列表（包含启用状态）

```bash
curl http://localhost:8000/api/plugins
```

响应：
```json
{
  "search": [
    {
      "name": "youtube",
      "version": "1.0.0",
      "description": "YouTube 搜索插件",
      "config_schema": [...],
      "enabled": true
    }
  ],
  "download": [
    {
      "name": "metube",
      "version": "1.0.0",
      "description": "MeTube 下载插件",
      "supported_protocols": ["http", "https", "m3u8"],
      "config_schema": [...],
      "enabled": true
    }
  ]
}
```

### 启用插件

```bash
curl -X POST "http://localhost:8000/api/plugins/download/metube/toggle?enabled=true"
```

### 禁用插件

```bash
curl -X POST "http://localhost:8000/api/plugins/download/metube/toggle?enabled=false"
```

## 配置文件格式

配置文件位置：`config/plugins.json`

```json
{
  "search:youtube": {
    "_enabled": true,
    "api_key": "your_api_key"
  },
  "download:metube": {
    "_enabled": false,
    "metube_url": "http://localhost:8081",
    "default_quality": "best"
  }
}
```

注意：`_enabled` 字段用于存储启用状态，默认为 `true`。

## 行为说明

### 禁用插件的影响

1. **搜索功能** - 禁用的搜索插件不会出现在搜索页面的插件选择器中
2. **下载功能** - 禁用的下载插件不会被自动选择，也不会出现在下载管理的平台列表中
3. **配置界面** - 禁用的插件配置按钮会被禁用，但仍然可以查看插件信息
4. **API 查询** - 查询下载记录时会自动跳过禁用的插件

### 默认状态

- 新注册的插件默认为启用状态
- 如果配置文件中没有 `_enabled` 字段，默认为 `true`
- 启用/禁用状态会持久化保存到配置文件

## 样式特性

### Tab 导航

- 激活的 Tab 有蓝色下划线
- 鼠标悬停时有背景色变化
- 切换时有平滑的过渡动画

### 开关按钮

- 使用标准的 Toggle Switch 样式
- 启用时为绿色，禁用时为灰色
- 有平滑的滑动动画

### 插件卡片

- 鼠标悬停时有阴影效果
- 展开配置时有下滑动画
- 响应式布局，适配不同屏幕尺寸

## 技术细节

### 状态管理

- 启用/禁用状态存储在配置文件中
- 前端通过 API 获取和更新状态
- 状态变化会立即生效，无需重启服务

### 性能优化

- 禁用的插件不会被查询，减少 API 调用
- Tab 切换使用 CSS 动画，性能流畅
- 配置区域按需加载，减少初始渲染时间

### 错误处理

- 切换状态失败时会自动恢复原状态
- 显示友好的错误提示
- 后端日志记录详细的错误信息

## 测试建议

1. 测试启用/禁用不同类型的插件
2. 测试禁用插件后的搜索和下载功能
3. 测试 Tab 切换的流畅性
4. 测试配置保存和加载
5. 测试错误情况的处理

## 未来改进

1. 添加批量启用/禁用功能
2. 添加插件依赖检查
3. 添加插件使用统计
4. 添加插件更新检查
5. 支持插件排序和分组
