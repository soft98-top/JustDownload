# 下载选项功能说明

## 功能概述

现在用户可以在下载视频时选择：
1. **下载插件** - 选择使用哪个下载器（Metube、qBittorrent等）
2. **剧集选择** - 对于多集视频，可以选择下载特定集数
3. **M3U8解析器** - 选择使用原始地址或加速解析地址

## 使用流程

### 1. 搜索视频
- 选择搜索插件（如SeaCMS）
- 输入关键词搜索
- 查看搜索结果

### 2. 打开下载选项
- 点击搜索结果中的"下载选项"按钮
- 弹出下载配置对话框

### 3. 配置下载选项

#### 剧集选择（多集视频）
- 默认：全部下载
- 可选：选择特定集数下载
- 显示集数名称和播放器标识

#### M3U8解析器（如果有）
- 默认：使用原始地址
- 可选：使用配置的解析器加速播放
  - P2P商业加速
  - 备用解析
  - 等等...

#### 下载插件
- 默认：自动选择（根据URL类型）
  - m3u8 → Metube
  - magnet/torrent → qBittorrent
  - http/https → Metube
- 可选：手动指定下载插件

#### 下载地址预览
- 实时显示将要下载的URL
- 根据选择的剧集和解析器动态更新

### 4. 确认下载
- 点击"确认下载"按钮
- 系统创建下载任务
- 显示任务创建成功信息

## 界面截图说明

### 搜索结果卡片
```
┌─────────────────────────────────────────┐
│ [封面图]  标题: 斗罗大陆2：绝世唐门      │
│           第129集 · 129集 · 来源: 茅台   │
│           https://vodcnd03...           │
│           [下载选项]                     │
└─────────────────────────────────────────┘
```

### 下载选项对话框
```
┌─────────────────────────────────────────┐
│ 下载选项                            [×] │
├─────────────────────────────────────────┤
│ 斗罗大陆2：绝世唐门                      │
│ 第129集 · 129集                         │
│                                         │
│ 选择剧集:                               │
│ [▼ 第01集 (mtm3u8)              ]      │
│                                         │
│ M3U8解析器:                             │
│ [▼ P2P商业加速                  ]      │
│                                         │
│ 下载插件:                               │
│ [▼ 自动选择                     ]      │
│                                         │
│ 下载地址:                               │
│ https://mtjiexi.cc:966/?url=...        │
│                                         │
│                    [取消] [确认下载]    │
└─────────────────────────────────────────┘
```

## 技术实现

### 前端组件

#### DownloadDialog.vue
- 独立的下载配置对话框组件
- Props:
  - `show`: 是否显示对话框
  - `result`: 搜索结果对象
  - `downloadPlugins`: 可用的下载插件列表
- Events:
  - `close`: 关闭对话框
  - `download`: 确认下载，传递配置数据

#### Search.vue 更新
- 添加 `DownloadDialog` 组件
- 新增方法：
  - `openDownloadDialog(result)`: 打开下载对话框
  - `handleDownload(downloadData)`: 处理下载请求
- 显示更丰富的搜索结果信息

### 后端API

#### POST /api/download
请求体：
```json
{
  "url": "https://...",
  "title": "视频标题",
  "plugin_name": "metube",  // 可选，不指定则自动选择
  "metadata": {
    "episode": "第01集",
    "parser": "P2P商业加速"
  }
}
```

响应：
```json
{
  "status": "success",
  "task": {
    "id": "uuid",
    "url": "...",
    "title": "...",
    "status": "pending",
    "plugin_name": "metube",
    "save_path": "/downloads"
  }
}
```

## 优势

1. **灵活性** - 用户可以根据需求选择最合适的下载方式
2. **透明度** - 清楚地看到将要下载的URL和使用的工具
3. **便捷性** - 对于多集视频，可以单独下载某一集
4. **加速** - 可以选择使用解析器加速m3u8播放
5. **兼容性** - 支持不同类型的下载协议和工具

## 未来改进

1. **批量下载** - 支持选择多集批量下载
2. **下载队列** - 显示当前下载队列和进度
3. **下载历史** - 记录已下载的内容
4. **收藏功能** - 收藏喜欢的视频
5. **自动选择优化** - 根据历史使用习惯智能推荐下载方式
