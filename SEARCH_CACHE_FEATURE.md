# 搜索结果缓存功能

## 功能说明

搜索结果会自动保存到浏览器的 localStorage 中，即使用户切换页面或刷新浏览器，搜索结果也不会丢失。

## 特性

### 1. 自动保存
- 每次搜索成功后自动保存结果
- 保存内容包括：
  - 搜索结果列表
  - 搜索关键词
  - 使用的搜索插件
  - 保存时间戳

### 2. 自动恢复
- 页面加载时自动检查缓存
- 如果有有效缓存，自动恢复搜索结果
- 在控制台显示恢复的结果数量

### 3. 缓存过期
- 缓存有效期：24小时
- 超过24小时的缓存会被自动清除
- 确保数据的时效性

### 4. 手动清除
- 页面右上角显示"清除结果"按钮
- 点击可立即清除所有搜索结果和缓存
- 清除后显示提示消息

### 5. 新搜索覆盖
- 执行新搜索时，旧缓存会被新结果覆盖
- 确保缓存始终是最新的搜索结果

## 使用场景

### 场景1：页面切换
```
用户操作：
1. 搜索"电影名称"，得到10条结果
2. 切换到"设置"页面配置插件
3. 返回"搜索"页面

结果：
✓ 搜索结果自动恢复
✓ 关键词自动填充
✓ 无需重新搜索
```

### 场景2：浏览器刷新
```
用户操作：
1. 搜索"电视剧名称"，得到20条结果
2. 不小心刷新了浏览器（F5）

结果：
✓ 页面重新加载后，搜索结果自动恢复
✓ 可以继续查看和操作
```

### 场景3：临时关闭标签页
```
用户操作：
1. 搜索"综艺节目"，得到15条结果
2. 关闭标签页去做其他事情
3. 几小时后重新打开应用

结果：
✓ 如果在24小时内，搜索结果自动恢复
✓ 超过24小时，缓存自动清除
```

## 技术实现

### 数据结构
```javascript
{
  results: [...],           // 搜索结果数组
  keyword: "搜索关键词",     // 搜索关键词
  plugin: "seacms",         // 使用的插件
  timestamp: "2023-12-05T10:30:00.000Z"  // 保存时间
}
```

### 存储位置
- 使用浏览器的 `localStorage`
- 键名：`search_cache`
- 每个浏览器独立存储

### 缓存大小
- localStorage 通常限制为 5-10MB
- 搜索结果通常很小（几百KB）
- 足够存储大量搜索结果

## 优势

1. **用户体验提升**
   - 避免重复搜索
   - 减少等待时间
   - 提高操作流畅性

2. **减少服务器负载**
   - 减少不必要的API请求
   - 节省带宽
   - 提高响应速度

3. **数据持久化**
   - 跨页面保持数据
   - 跨会话保持数据（24小时内）
   - 自动清理过期数据

4. **灵活控制**
   - 用户可以手动清除
   - 新搜索自动覆盖
   - 过期自动清理

## 注意事项

### 1. 隐私考虑
- 缓存存储在本地浏览器
- 不会上传到服务器
- 清除浏览器数据会同时清除缓存

### 2. 存储限制
- 如果 localStorage 已满，保存会失败
- 失败时不影响正常搜索功能
- 错误会在控制台记录

### 3. 浏览器兼容性
- 支持所有现代浏览器
- IE 8+ 支持 localStorage
- 隐私模式可能限制 localStorage

### 4. 数据同步
- 缓存仅在当前浏览器有效
- 不同浏览器/设备不共享缓存
- 不同浏览器标签页共享缓存

## 未来改进

### 可能的增强功能

1. **搜索历史**
   - 保存多次搜索记录
   - 快速切换历史搜索
   - 搜索历史管理

2. **收藏功能**
   - 收藏喜欢的视频
   - 持久化收藏列表
   - 导出/导入收藏

3. **缓存配置**
   - 自定义缓存过期时间
   - 选择是否启用缓存
   - 缓存大小限制

4. **云端同步**
   - 登录后同步到云端
   - 跨设备访问搜索结果
   - 团队共享搜索结果

## 代码示例

### 保存缓存
```javascript
saveSearchCache() {
  const cacheData = {
    results: this.results,
    keyword: this.keyword,
    plugin: this.selectedPlugin,
    timestamp: new Date().toISOString()
  }
  localStorage.setItem('search_cache', JSON.stringify(cacheData))
}
```

### 加载缓存
```javascript
loadSearchCache() {
  const cached = localStorage.getItem('search_cache')
  if (cached) {
    const data = JSON.parse(cached)
    // 检查是否过期（24小时）
    const hoursDiff = (Date.now() - new Date(data.timestamp)) / (1000 * 60 * 60)
    if (hoursDiff < 24) {
      this.results = data.results
      this.keyword = data.keyword
      this.selectedPlugin = data.plugin
    }
  }
}
```

### 清除缓存
```javascript
clearResults() {
  this.results = []
  this.keyword = ''
  localStorage.removeItem('search_cache')
}
```

## 总结

搜索结果缓存功能通过本地存储技术，为用户提供了更流畅的使用体验。它在不增加服务器负担的情况下，有效地保护了用户的搜索成果，避免了因页面切换或刷新导致的数据丢失。
